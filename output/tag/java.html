<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>Turbidsoul's 小黑屋 - java</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Turbidsoul's 小黑屋 </a></h1>
                <nav><ul>
                    <li><a href="/category/firefox.html">firefox</a></li>
                    <li><a href="/category/java.html">Java</a></li>
                    <li><a href="/category/jekyll.html">jekyll</a></li>
                    <li><a href="/category/jquery.html">jquery</a></li>
                    <li><a href="/category/linux.html">Linux</a></li>
                    <li><a href="/category/markdown.html">Markdown</a></li>
                    <li><a href="/category/math.html">Math</a></li>
                    <li><a href="/category/maven.html">Maven</a></li>
                    <li><a href="/category/nginx.html">Nginx</a></li>
                    <li><a href="/category/posts.html">posts</a></li>
                    <li><a href="/category/python.html">Python</a></li>
                    <li><a href="/category/rtmp.html">RTMP</a></li>
                    <li><a href="/category/selenium.html">Selenium</a></li>
                    <li><a href="/category/sublime.html">Sublime</a></li>
                    <li><a href="/category/sublime2.html">Sublime2</a></li>
                    <li><a href="/category/webrtc.html">WebRTC</a></li>
                    <li><a href="/category/xian-liao.html">闲聊</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/posts/shi-yong-seleniumjin-xing-webce-shi-ru-men-he-shi-yong-webdriverkai-fa-webce-shi-dai-ma-ru-men.html">使用selenium进行web测试入门和使用WebDriver开发web测试代码入门</a></h1>
<footer class="post-info">
        <abbr class="published" title="2013-10-17T00:00:00">
                周四 17 十月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/selenium.html">Selenium</a>. </p>
<p>tags: <a href="/tag/selenium.html">selenium</a><a href="/tag/python.html">python</a><a href="/tag/java.html">java</a><a href="/tag/webdriver.html">webdriver</a><a href="/tag/test.html">test</a><a href="/tag/code.html">code</a></p>
</footer><!-- /.post-info --><p>前段时间我们头在搞一个分布式测试，使用的就是 <strong>Selenium</strong> 可以坑太多，最后应该是放弃了，因为我没见到回音，说实话这东西是bug挺多，而且在firefox上的版本兼容也有很大的问题，不过这不是我们讨论的问题，我们这里要讨论的是使用它来做简单的web测试。</p>
<h2>Selenium 入门</h2>
<h4>安装</h4>
<p>我使用的是 Firefox Aurora 现在的版本就是ff26,这下面是正常的，我不知道在每日编译版下是否正常，虽然我机子上也安装了，但是并没有在起下面做个测试，不过应该是没有问题的。</p>
<p>在 <a href="about:addons">about:addons</a> 或者 <a href="http://addons.mozilla.org/">http://addons.mozilla.org/</a> 上搜索 <em>selenium</em> 点击安装，安装的时候同时还会附带安装几个其他的插件，这些都是 Selenium 的一些附属插件，我在之后的会有介绍。</p>
<p>安装完之后可以在 <code>菜单 &gt;&gt; 工具 &gt;&gt; Selenium IDE</code> 打开或者在 <em>附加组建栏</em> 点击 Selenium IDE 按钮打开，如何附加组建栏没有，请自行添加。</p>
<p><img alt="Selenium IDE 界面" src="/file/images/selenium1.jpg" title="Selenium IDE" /></p>
<p>上图就是 Selenium IDE 界面，图最右边的红色圆形按钮就是录制按钮，一般在打开的时候这个那就就是按下的，所以可以直接录制。</p>
<p>录制的方式很简单，当点击录制按钮之后就可以在网站的页面向普通浏览网页一样操作，Selenium会自动记录下操作我已经做了简单的几次点击操作，下面使我录制下来的代码：</p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;en&quot;</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head</span> <span class="na">profile=</span><span class="s">&quot;http://selenium-ide.openqa.org/profiles/test-case&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;selenium.base&quot;</span> <span class="na">href=</span><span class="s">&quot;http://www.kaoshidian.com/&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;title&gt;</span>New Test<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;table</span> <span class="na">cellpadding=</span><span class="s">&quot;1&quot;</span> <span class="na">cellspacing=</span><span class="s">&quot;1&quot;</span> <span class="na">border=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;thead&gt;</span>
<span class="nt">&lt;tr&gt;&lt;td</span> <span class="na">rowspan=</span><span class="s">&quot;1&quot;</span> <span class="na">colspan=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>New Test<span class="nt">&lt;/td&gt;&lt;/tr&gt;</span>
<span class="nt">&lt;/thead&gt;&lt;tbody&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>open<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>/<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>click<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>css=div.wrap<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>clickAndWait<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>link=课程中心<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>clickAndWait<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>xpath=(//a[contains(text(),&#39;专业课一对一&#39;)])[2]<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>clickAndWait<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>xpath=(//a[contains(text(),&#39;微直播&#39;)])[2]<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span>clickAndWait<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span>link=精彩视频<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>

<span class="nt">&lt;/tbody&gt;&lt;/table&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>上面的代码就是录制后的代码，是html代码，当然也可以按照在这样的方法写出来，复制到Selenium中也是可以运行的。</p>
<p>运行的方法很简单，菜单 Actions -&gt; Play entire test suite 就会把录制的脚本运行一边，同时我们也能在浏览器上看到运行的结果。</p>
<p>Selenium可以完成我们在浏览器上的所有操作，因为它就是模拟我们浏览器的操作，所以登录等操作也是没有问题的。这就是Selenium的几本操作，更加复杂的可以自己去探索.</p>
<p>Selenium也可以把录制的宏导出成其他代码，比如java,ruby,php,python,C#,XML等，导出的方法很简单，在菜单中的 文件 -&gt; Export Test Case 就可以看到导出的选项，但是要要导出这些代码，是需要有扩展支持的，一般这些扩展在安装 Selenium IDE 的时候都会提示一起安装，如果在这里没有看到的花，可以在<a href="http://addons.mozilla.org/">http://addons.mozilla.org</a>搜索，然后安装，重启firefox之后就可以了</p>
<h2>Python</h2>
<p>如何得到python 的测试代码呢？有两种，第一个就是通过Selenium中提供的导出的方法直接导出，另外一个就是自己编写python代码了。</p>
<p>从Selenium可以导出两种，一种是基于<code>Webdriver</code>，另外一个就是基于<code>Remote Control</code>：</p>
<div class="highlight"><pre><span class="c"># webdriver #</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">Select</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">re</span>

<span class="k">class</span> <span class="nc">TestWebdriver</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s">&quot;http://www.kaoshidian.com/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verificationErrors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_next_alert</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">test_webdriver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&quot;div.wrap&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_link_text</span><span class="p">(</span><span class="s">u&quot;课程中心&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">u&quot;(//a[contains(text(),&#39;专业课一对一&#39;)])[2]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">u&quot;(//a[contains(text(),&#39;微直播&#39;)])[2]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_link_text</span><span class="p">(</span><span class="s">u&quot;精彩视频&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_element_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">how</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">how</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">what</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">is_alert_present</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">switch_to_alert</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">NoAlertPresentException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">close_alert_and_get_its_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">alert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">switch_to_alert</span><span class="p">()</span>
            <span class="n">alert_text</span> <span class="o">=</span> <span class="n">alert</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_next_alert</span><span class="p">:</span>
                <span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">alert</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">alert_text</span>
        <span class="k">finally</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_next_alert</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">verificationErrors</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>

<span class="c">#########################################################</span>

<span class="c"># Remote Control #</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">selenium</span>
<span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">re</span>

<span class="k">class</span> <span class="nc">test_remote</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verificationErrors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span> <span class="o">=</span> <span class="n">selenium</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">4444</span><span class="p">,</span> <span class="s">&quot;*firefox x:/xxxxxxx/Mozilla Firefox/firefox.exe&quot;</span><span class="p">,</span> <span class="s">&quot;http://www.kaoshidian.com/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_test_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s">&quot;css=div.wrap&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s">u&quot;link=课程中心&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">wait_for_page_to_load</span><span class="p">(</span><span class="s">&quot;30000&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s">u&quot;xpath=(//a[contains(text(),&#39;专业课一对一&#39;)])[2]&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">wait_for_page_to_load</span><span class="p">(</span><span class="s">&quot;30000&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s">u&quot;xpath=(//a[contains(text(),&#39;微直播&#39;)])[2]&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">wait_for_page_to_load</span><span class="p">(</span><span class="s">&quot;30000&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="s">u&quot;link=精彩视频&quot;</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">wait_for_page_to_load</span><span class="p">(</span><span class="s">&quot;30000&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="bp">self</span><span class="o">.</span><span class="n">verificationErrors</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>在运行这段代码之前，需要安装selenium的python包 <code>pip install selenium</code>,如果安装的时候出现<code>error: invalid command 'egg_info'</code>这个错误，则需要升级<code>Setuptools</code>,运行<code>pip install -upgrade setuptools</code>进行升级，如果运行代码的时候，虽然浏览器启动起来了但是没有打开网站之类的情况，则需要升级selenium或者降低安装的浏览器版本，可能是当前安装的版本太低了，和机子上的安装的浏览器版本不兼容。</p>
<p>运行结果如下:</p>
<div class="highlight"><pre><span class="nl">C:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Turbidsoul</span><span class="err">\</span><span class="n">Desktop</span><span class="o">&gt;</span><span class="n">python</span> <span class="n">test_webdriver</span><span class="p">.</span><span class="n">py</span>
<span class="p">.</span>
<span class="o">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span> <span class="n">in</span> <span class="mf">27.629</span><span class="n">s</span>

<span class="n">OK</span>
</pre></div>


<p>对于Remote Control方式，在运行之前需要下载<a href="https://code.google.com/p/selenium/downloads/list">selenium-server-standalone-<version>.jar</a>,下载完成后，在命令行下运行<code>java -jar selenium-server-standalone-&lt;version&gt;.jar</code> 启动服务，启动成功后能看下如下信息：</p>
<div class="highlight"><pre><span class="err">十月</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">2013</span> <span class="mi">11</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">28</span> <span class="err">下午</span> <span class="n">org</span><span class="p">.</span><span class="n">openqa</span><span class="p">.</span><span class="n">grid</span><span class="p">.</span><span class="n">selenium</span><span class="p">.</span><span class="n">GridLauncher</span> <span class="n">main</span>
<span class="err">信息</span><span class="o">:</span> <span class="n">Launching</span> <span class="n">a</span> <span class="n">standalone</span> <span class="n">server</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.219</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Java</span><span class="o">:</span> <span class="n">Oracle</span> <span class="n">Corporation</span> <span class="mf">21.0</span><span class="o">-</span><span class="n">b17</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.221</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">OS</span><span class="o">:</span> <span class="n">Windows</span> <span class="mi">7</span> <span class="mf">6.1</span> <span class="n">x86</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.229</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">v2</span><span class="mf">.37.0</span><span class="p">,</span> <span class="n">with</span> <span class="n">Core</span> <span class="n">v2</span><span class="mf">.37.0</span><span class="p">.</span> <span class="n">Built</span> <span class="n">from</span> <span class="n">revision</span> <span class="n">a7c61cb</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.339</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Default</span> <span class="n">driver</span> <span class="n">org</span><span class="p">.</span><span class="n">openqa</span><span class="p">.</span><span class="n">selenium</span><span class="p">.</span><span class="n">iphone</span><span class="p">.</span><span class="n">IPhoneDriver</span> <span class="n">registration</span> <span class="n">is</span> <span class="n">skipped</span><span class="o">:</span> <span class="n">registration</span> <span class="n">capabilities</span> <span class="n">Capabilities</span> <span class="p">[{</span><span class="n">platform</span><span class="o">=</span><span class="n">AC</span><span class="p">,</span> <span class="n">browserName</span><span class="o">=</span><span class="n">iPad</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="p">}]</span> <span class="n">does</span> <span class="n">not</span> <span class="n">match</span> <span class="n">with</span> <span class="n">current</span> <span class="n">platform</span><span class="o">:</span> <span class="n">VISTA</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.356</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Default</span> <span class="n">driver</span> <span class="n">org</span><span class="p">.</span><span class="n">openqa</span><span class="p">.</span><span class="n">selenium</span><span class="p">.</span><span class="n">iphone</span><span class="p">.</span><span class="n">IPhoneDriver</span> <span class="n">registration</span> <span class="n">is</span> <span class="n">skipped</span><span class="o">:</span> <span class="n">registration</span> <span class="n">capabilities</span> <span class="n">Capabilities</span> <span class="p">[{</span><span class="n">platform</span><span class="o">=</span><span class="n">AC</span><span class="p">,</span> <span class="n">browserName</span><span class="o">=</span><span class="n">iPhone</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="p">}]</span> <span class="n">does</span> <span class="n">not</span> <span class="n">match</span> <span class="n">with</span> <span class="n">current</span> <span class="n">platform</span><span class="o">:</span> <span class="n">VISTA</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.407</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">RemoteWebDriver</span> <span class="n">instances</span> <span class="n">should</span> <span class="n">connect</span> <span class="n">to</span><span class="o">:</span> <span class="n">http</span><span class="o">:</span><span class="c1">//127.0.0.1:4444/wd/hub</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.408</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Version</span> <span class="n">Jetty</span><span class="o">/</span><span class="mf">5.1</span><span class="p">.</span><span class="n">x</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.409</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Started</span> <span class="n">HttpContext</span><span class="p">[</span><span class="o">/</span><span class="n">selenium</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">driver</span><span class="p">,</span><span class="o">/</span><span class="n">selenium</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">driver</span><span class="p">]</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.410</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Started</span> <span class="n">HttpContext</span><span class="p">[</span><span class="o">/</span><span class="n">selenium</span><span class="o">-</span><span class="n">server</span><span class="p">,</span><span class="o">/</span><span class="n">selenium</span><span class="o">-</span><span class="n">server</span><span class="p">]</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.410</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Started</span> <span class="n">HttpContext</span><span class="p">[</span><span class="o">/</span><span class="p">,</span><span class="o">/</span><span class="p">]</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.553</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Started</span> <span class="n">org</span><span class="p">.</span><span class="n">openqa</span><span class="p">.</span><span class="n">jetty</span><span class="p">.</span><span class="n">jetty</span><span class="p">.</span><span class="n">servlet</span><span class="p">.</span><span class="n">ServletHandler</span><span class="err">@</span><span class="n">a450bb</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.553</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Started</span> <span class="n">HttpContext</span><span class="p">[</span><span class="o">/</span><span class="n">wd</span><span class="p">,</span><span class="o">/</span><span class="n">wd</span><span class="p">]</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.558</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Started</span> <span class="n">SocketListener</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">4444</span>
<span class="mi">3</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mf">30.559</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Started</span> <span class="n">org</span><span class="p">.</span><span class="n">openqa</span><span class="p">.</span><span class="n">jetty</span><span class="p">.</span><span class="n">jetty</span><span class="p">.</span><span class="n">Server</span><span class="err">@</span><span class="mi">314585</span>
</pre></div>


<p>现在可以运行，Remote Control 那段代码，运行的时候会新打开两个firefox窗口，一个显示当前运行情况的控制台信息，另外一个就是现在我们网站页面，并且可以在运行 <em>selenium-server-standalong-<version>.jar</em> 的窗口看到如下信息：</p>
<div class="highlight"><pre><span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">03.707</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">creating</span> <span class="k">new</span> <span class="n">remote</span> <span class="n">session</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">03.765</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Allocated</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span> <span class="k">for</span> <span class="n">http</span><span class="o">://</span><span class="n">www</span><span class="o">.</span><span class="na">kaoshidian</span><span class="o">.</span><span class="na">com</span><span class="o">/,</span> <span class="n">launching</span><span class="o">...</span>
<span class="n">jar</span><span class="o">:</span><span class="n">file</span><span class="o">:/</span><span class="n">E</span><span class="o">:/</span><span class="n">opensource</span><span class="sr">/selenium/selenium-server-standalone-2.37.0.jar!/</span><span class="n">customProfileDirCUSTFFCHROME</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">03.925</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Preparing</span> <span class="n">Firefox</span> <span class="n">profile</span><span class="o">...</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">08.889</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Launching</span> <span class="n">Firefox</span><span class="o">...</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">15.537</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span><span class="o">,</span><span class="n">c096289dc3174e68b7be194a7bd27447</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">15.543</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">open</span><span class="o">[/,</span> <span class="n">True</span><span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">19.860</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">19.866</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">click</span><span class="o">[</span><span class="n">css</span><span class="o">=</span><span class="n">div</span><span class="o">.</span><span class="na">wrap</span><span class="o">,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">19.889</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">19.893</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">click</span><span class="o">[</span><span class="n">link</span><span class="o">=</span><span class="err">课程中心</span><span class="o">,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">19.926</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">19.931</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">waitForPageToLoad</span><span class="o">[</span><span class="mi">30000</span><span class="o">,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">21.832</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">21.838</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">click</span><span class="o">[</span><span class="n">xpath</span><span class="o">=(//</span><span class="n">a</span><span class="o">[</span><span class="n">contains</span><span class="o">(</span><span class="n">text</span><span class="o">(),</span><span class="s1">&#39;专业课一对一&#39;</span><span class="o">)])[</span><span class="mi">2</span><span class="o">],</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">21.870</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">21.876</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">waitForPageToLoad</span><span class="o">[</span><span class="mi">30000</span><span class="o">,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">25.504</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">25.509</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">click</span><span class="o">[</span><span class="n">xpath</span><span class="o">=(//</span><span class="n">a</span><span class="o">[</span><span class="n">contains</span><span class="o">(</span><span class="n">text</span><span class="o">(),</span><span class="s1">&#39;微直播&#39;</span><span class="o">)])[</span><span class="mi">2</span><span class="o">],</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">25.528</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">25.534</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">waitForPageToLoad</span><span class="o">[</span><span class="mi">30000</span><span class="o">,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">28.735</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">28.740</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">click</span><span class="o">[</span><span class="n">link</span><span class="o">=</span><span class="err">精彩视频</span><span class="o">,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">28.767</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">28.773</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">waitForPageToLoad</span><span class="o">[</span><span class="mi">30000</span><span class="o">,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">30.402</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">30.408</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">testComplete</span><span class="o">[,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">30.409</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Killing</span> <span class="n">Firefox</span><span class="o">...</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">36</span><span class="o">:</span><span class="mf">30.613</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">OK</span> <span class="n">on</span> <span class="n">session</span> <span class="n">c096289dc3174e68b7be194a7bd27447</span>
</pre></div>


<p>上面显示的就是运行成功每一步之后服务端控制台显示的信息，如果没有出现这类情况而是出现一下的信息：</p>
<div class="highlight"><pre><span class="mi">23</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mf">44.930</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Command</span> <span class="n">request</span><span class="o">:</span> <span class="n">getNewBrowserSession</span><span class="o">[*</span><span class="n">firefox3</span><span class="o">,</span> <span class="n">http</span><span class="o">://</span><span class="n">www</span><span class="o">.</span><span class="na">kaoshidian</span><span class="o">.</span><span class="na">com</span><span class="o">/,</span> <span class="o">]</span> <span class="n">on</span> <span class="n">session</span> <span class="kc">null</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mf">44.931</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">creating</span> <span class="k">new</span> <span class="n">remote</span> <span class="n">session</span>
<span class="mi">23</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mf">44.936</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Got</span> <span class="n">result</span><span class="o">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">start</span> <span class="k">new</span> <span class="n">browser</span> <span class="n">session</span><span class="o">:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">RuntimeException</span><span class="o">:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">RuntimeException</span><span class="o">:</span> <span class="n">Firefox</span> <span class="mi">3</span> <span class="n">could</span> <span class="n">not</span> <span class="n">be</span> <span class="n">found</span> <span class="k">in</span> <span class="n">the</span> <span class="n">path</span><span class="o">!</span>
<span class="n">Please</span> <span class="n">add</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">containing</span> <span class="s1">&#39;&#39;</span><span class="n">firefox</span><span class="o">.</span><span class="na">exe</span><span class="s1">&#39;&#39;</span> <span class="n">to</span> <span class="n">your</span> <span class="n">PATH</span> <span class="n">environment</span>
<span class="n">variable</span><span class="o">,</span> <span class="n">or</span> <span class="n">explicitly</span> <span class="n">specify</span> <span class="n">a</span> <span class="n">path</span> <span class="n">to</span> <span class="n">Firefox</span> <span class="mi">3</span> <span class="n">like</span> <span class="k">this</span><span class="o">:</span>
<span class="o">*</span><span class="n">firefox3</span> <span class="n">c</span><span class="o">:\</span><span class="n">blah</span><span class="o">\</span><span class="n">firefox</span><span class="o">.</span><span class="na">exe</span> <span class="n">on</span> <span class="n">session</span> <span class="kc">null</span>
</pre></div>


<p>则是因为没有在环境变量中配置firefox的路径，不过这里不需要在环境变量里配置，只需要在<code>selenium("localhost", 4444, "*firefox x:/xxxxxx/Mozilla Firefox/firefox.exe", "http://www.kaoshidian.com/")</code> 声明即可，一般通过selenium生成的代码这里是 <code>selenium("localhost", 4444, "*chrome", "http://www.kaoshidian.com/")</code> 所以这里需要注意修改一下。</p>
<h2>Java</h2>
<p>Selenium导出的是也是分为Webdriver和Remote Control 两种，同时也基于junit3和4，在这里我就只做一个Webdriver的例子。</p>
<p>我们先创建一个maven项目，然后在<code>pom.xml</code>文件中加入关于selenium的声明：</p>
<div class="highlight"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.seleniumhq.selenium<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>selenium-java<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.37.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>这里我不得不吐槽一下，这玩意居然依赖了这么多包，太坑爹。</p>
<p>下来就是用Selenium IDE 导出java的测试代码：</p>
<div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">tests</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">CoreMatchers</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">org.openqa.selenium.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.openqa.selenium.firefox.FirefoxDriver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.openqa.selenium.support.ui.Select</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SeleniumTest</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">WebDriver</span> <span class="n">driver</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">baseUrl</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">acceptNextAlert</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">StringBuffer</span> <span class="n">verificationErrors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>

  <span class="nd">@Before</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FirefoxDriver</span><span class="o">();</span>
    <span class="n">baseUrl</span> <span class="o">=</span> <span class="s">&quot;http://www.kaoshidian.com/&quot;</span><span class="o">;</span>
    <span class="n">driver</span><span class="o">.</span><span class="na">manage</span><span class="o">().</span><span class="na">timeouts</span><span class="o">().</span><span class="na">implicitlyWait</span><span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">driver</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">baseUrl</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span><span class="o">);</span>
    <span class="n">driver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">cssSelector</span><span class="o">(</span><span class="s">&quot;div.wrap&quot;</span><span class="o">)).</span><span class="na">click</span><span class="o">();</span>
    <span class="n">driver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">linkText</span><span class="o">(</span><span class="s">&quot;课程中心&quot;</span><span class="o">)).</span><span class="na">click</span><span class="o">();</span>
    <span class="n">driver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">xpath</span><span class="o">(</span><span class="s">&quot;(//a[contains(text(),&#39;专业课一对一&#39;)])[2]&quot;</span><span class="o">)).</span><span class="na">click</span><span class="o">();</span>
    <span class="n">driver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">xpath</span><span class="o">(</span><span class="s">&quot;(//a[contains(text(),&#39;微直播&#39;)])[2]&quot;</span><span class="o">)).</span><span class="na">click</span><span class="o">();</span>
    <span class="n">driver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">linkText</span><span class="o">(</span><span class="s">&quot;精彩视频&quot;</span><span class="o">)).</span><span class="na">click</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@After</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">driver</span><span class="o">.</span><span class="na">quit</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">verificationErrorString</span> <span class="o">=</span> <span class="n">verificationErrors</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">verificationErrorString</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">fail</span><span class="o">(</span><span class="n">verificationErrorString</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isElementPresent</span><span class="o">(</span><span class="n">By</span> <span class="n">by</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">driver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">by</span><span class="o">);</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchElementException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isAlertPresent</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">driver</span><span class="o">.</span><span class="na">switchTo</span><span class="o">().</span><span class="na">alert</span><span class="o">();</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoAlertPresentException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="nf">closeAlertAndGetItsText</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">Alert</span> <span class="n">alert</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="na">switchTo</span><span class="o">().</span><span class="na">alert</span><span class="o">();</span>
      <span class="n">String</span> <span class="n">alertText</span> <span class="o">=</span> <span class="n">alert</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">acceptNextAlert</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">alert</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">alert</span><span class="o">.</span><span class="na">dismiss</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">alertText</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">acceptNextAlert</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>上面的代码运行的是偶可能会跑错，指示说没有指定firefox的路径，所以我们需要指定一下路径，方法很简单，就是修改创建driver实例的地方，<code>new FirefoxDriver(new FirefoxBinary(new File("x:\\xxxxxxxxxxx\\Mozilla Firefox\\firefox.exe")), new FirefoxProfile());</code> 这样在运行就可以了，运行之后就能看到我们之前在运行python一样的结果。</p>
<p>至于Remote Control我就不在这里在多说了，有兴趣的朋友可以自己去试一下，和python的Remote Control差不多的。</p>
<h2>结论</h2>
<p>Selenium其实还有支持很多，比如Ruby,PHP,Perl,Hashel,Javascript,Objective-C等语言，也支持Chrome,Opera,IE等主流的浏览器，不过在兼容性上我没发给出确切的答案，因为没有做过测试，但是我们头做这个的分布式测试时候，倒是深有体会。同时也在支持在android和iOS上的测试，在功能上还是很全面的，操作也简单，是web测试中上佳的选择。</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/ge-csscuo-wu-yin-qi-de-maven-stackoverflowerror.html" rel="bookmark"
                           title="Permalink to 一个css错误引起的maven StackOverflowError">一个css错误引起的maven StackOverflowError</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-06-18T00:00:00">
                周二 18 六月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/java.html">Java</a>. </p>
<p>tags: <a href="/tag/java.html">java</a><a href="/tag/maven.html">maven</a><a href="/tag/css.html">css</a></p>
</footer><!-- /.post-info -->                <p>这个问题是我的一个失误造成的，这是上一片文章的后续，我在使用正则做文本替换的时候没有注意到，这个正则在主干上是正常的，但是在分支上执行的时候使一行css少了一个引号，这个问题在浏览器中是暴露不出来的，之后在maven打包的时候对文件做压缩的时候才会出现，下面我们来看看是什么样的问题。</p>
<p>我们项目使用的是 <a href="https://github.com/davidB/yuicompressor-maven-plugin" title="yuicompressor-maven-plugin">yuicompressor-maven-plugin</a> 做js和css的压缩，在压缩的过程中出现了下面的错误：</p>
<div class="highlight"><pre><span class="o">---------------------------------------------------</span>
<span class="n">constituent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span> <span class="n">file</span><span class="o">:/</span><span class="n">E</span><span class="o">:/</span><span class="n">opensource</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="n">maven</span><span class="o">-</span><span class="mf">2.2.1</span><span class="p">.</span><span class="n">RELEASE</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">aether</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="mf">1.13.1</span><span class="p">.</span><span class="n">jar</span>
<span class="n">constituent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span> <span class="n">file</span><span class="o">:/</span><span class="n">E</span><span class="o">:/</span><span class="n">opensource</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="n">maven</span><span class="o">-</span><span class="mf">2.2.1</span><span class="p">.</span><span class="n">RELEASE</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">aether</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">wagon</span><span class="o">-</span><span class="mf">1.13.1</span><span class="p">.</span><span class="n">jar</span>
<span class="n">constituent ...</span></pre></div>
                <a class="readmore" href="/posts/ge-csscuo-wu-yin-qi-de-maven-stackoverflowerror.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/lesscss-maven-pluginjian-dan-de-pei-zhi.html" rel="bookmark"
                           title="Permalink to lesscss maven plugin简单的配置">lesscss maven plugin简单的配置</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-06-11T00:00:00">
                周二 11 六月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/maven.html">Maven</a>. </p>
<p>tags: <a href="/tag/lesscss.html">lesscss</a><a href="/tag/maven.html">maven</a><a href="/tag/java.html">java</a></p>
</footer><!-- /.post-info -->                <p>这其实是一个很简单的问题，本来并不打算写成一片文章的，因为这个文件和另外一个问题是一起的，就是我们在nginx上做css和js文件合并时遇到的，不过在这之前我还遇到了另外一个问题，就是我们开发环境是windows7，而nginx下有个静态文件合并的模块: <strong>http_concat_module</strong> ，是<a href="https://github.com/alibaba/nginx-http-concat" title="HTTP Concatenation module for Nginx">淘宝</a>开源的，这个模块并不是nginx标准模块，所以要使用它需要自己重新编译nginx，具体如何编译我需要一段一点时间整理一下，在之后的文章中会写出来。</p>
<p>至于为什么要使用<a href="http://lesscss.org" title="The Dynamic Stylesheet language">less</a>是因为使用了 <strong>http_concat_module</strong> 之后css中文件的一些路径出现了错误，需要为css文件设置一些变量，其实使用maven的插件也可以进行变量替换，但是这样只能在maven打包的时候才能起作用，对于开发来说就不行，因为开发必须要求在编译的时候就生效。所以就需要使用maven的另一个插件<a href="https://github.com/marceloverdijk/lesscss-maven-plugin" title="Official LESS CSS Maven Plugin">lesscss-maven-plugin</a>，这个插件的作用就是在编译的时候就能把less转换成css，这样做对我们最大的好处就是需要修改的地方是最少的，而且能一劳永逸的解决这个问题。</p>
<p>现在我们来说说这个插件如何配置：</p>
<h4>添加插件</h4>
<div class="highlight"><pre><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.lesscss<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>lesscss-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.3.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>


<p>插件添加好后，就能在 <em>pom.xml ...</em></p>
                <a class="readmore" href="/posts/lesscss-maven-pluginjian-dan-de-pei-zhi.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/jdk8xin-te-xing-calendarbuilder.html" rel="bookmark"
                           title="Permalink to JDK8新特性 Calendar.Builder">JDK8新特性 Calendar.Builder</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-05-29T00:00:00">
                周三 29 五月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/java.html">Java</a>. </p>
<p>tags: <a href="/tag/java.html">java</a><a href="/tag/jdk8.html">jdk8</a></p>
</footer><!-- /.post-info -->                <p>5月23号，Oracle 发布了 jdk8 <strong>M7</strong> 版，这是一个<a href="http://openjdk.java.net/projects/jdk8/milestones#Feature_Complete">Feature Complete</a>，就是说它已经把所有特性和功能都加入。在翻看 <strong>M7</strong> 的文档时发现了 <a href="http://download.java.net/jdk8/docs/api/java/util/Locale.Builder.html" title="Locale.Builder"><em>Locale.Builder</em></a> ，在jdk7的时候加入过一个类似的：<a href="http://download.java.net/jdk8/docs/api/java/util/Locale.Builder.html" title="Locale.Builder"><em>Locale.Builder</em></a>, 下面我们来看看 <a href="http://download.java.net/jdk8/docs/api/java/util/Calendar.Builder.html" title="Calendar.Builder"><em>Calendar.Builder</em></a>。</p>
<h4>允许单语句设置</h4>
<p>允许使用 <a href="http://download.java.net/jdk8/docs/api/java/util/Calendar.Builder.html#set(int,%20int)" title="set(int, int)"><code>set(int, int)</code></a> 方法，为指定的Field设置值，如下：</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">java.util.Calendar</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Calendar</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">testSingleStatement</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Calendar</span> <span class="n">cal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Calendar ...</span></pre></div>
                <a class="readmore" href="/posts/jdk8xin-te-xing-calendarbuilder.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/ru-he-pei-zhi-zai-nginxhe-casshang-pei-zhi-ssl.html" rel="bookmark"
                           title="Permalink to 如何配置在nginx和cas上配置ssl？">如何配置在nginx和cas上配置ssl？</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-05-08T00:00:00">
                周三 08 五月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/nginx.html">Nginx</a>. </p>
<p>tags: <a href="/tag/nginx.html">nginx</a><a href="/tag/cas.html">cas</a><a href="/tag/ssl.html">ssl</a><a href="/tag/java.html">java</a><a href="/tag/https.html">https</a></p>
</footer><!-- /.post-info -->                <p>公司准备对登录服务采用https，而登录服务采用的是cas，前段的是用nginx代理， 所以就有了之后的几个问题。</p>
<p><strong>主要碰到了下面3个问题</strong> ：</p>
<ol>
<li>nginx中配置ssl</li>
<li>cas中开启ssl</li>
<li>java中导入证书</li>
</ol>
<hr />
<p>首先是生成我们的证书，我使用的是openssl：</p>
<ol>
<li>首先是生成私钥： openssl genrsa -out server.key</li>
<li>接下来要生成CSR文件： openssl req -new -key server.key -out server.csr</li>
<li>最后就是生成证书文件： openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</li>
</ol>
<p>这里有我一个笔记是openssl的简单教程：<a href="https://www.evernote.com/shard/s25/sh/233c0eda-2f70-4756-8907-50dc0bff82c2/92861a2bd473f1d703bcead620080d27">openssl简单教程</a></p>
<hr />
<p>生成证书后，就可以配置nginx了，打开nginx.conf，加入以下几行:</p>
<div class="highlight"><pre><span class="k">listen</span>                 <span class="mi">443 ...</span></pre></div>
                <a class="readmore" href="/posts/ru-he-pei-zhi-zai-nginxhe-casshang-pei-zhi-ssl.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/opensslhe-java-aessuan-fa-de-de-wen-ti.html" rel="bookmark"
                           title="Permalink to OpenSSL和Java AES算法的的问题">OpenSSL和Java AES算法的的问题</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-03-13T00:00:00">
                周三 13 三月 2013
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/java.html">Java</a>. </p>
<p>tags: <a href="/tag/openssl.html">openssl</a><a href="/tag/java.html">java</a><a href="/tag/aes.html">aes</a><a href="/tag/arithmetic.html">arithmetic</a></p>
</footer><!-- /.post-info -->                <p>开篇第一句话我想说， <strong>OpenSSL不支持与Java的对接</strong> ，这是多么蛋疼的一句话，不过确实是这样，原因是在c中的填充方式和Java中的填充方式不一样，Java不支持c中的/0的填充方式。</p>
<p>具体信息请查看：<a href="http://blog.csdn.net/rocketball/article/details/6575677">OpenSSL和JAVA AES算法的问题总结</a></p>
<p>至于我为什么会写这篇文章呢，是我们的项目中有部分在网络传输的内容需要加密，所以就选用了AES的，服务端使用的是<a href="http://openresty.org/">openresty</a> 这是淘宝的一个大牛写的，他里面集成了LuaJit， 加密的部分使用的是resty.aes，而resty使用的是OpenSSL的C代码实现的加密解密。为了和OpenSSL实现对接，我就蛋疼的去简单的链接了下OpenSSL，在上面的文章中才指导OpenSSL并不支持Java，查了无数人的文章，很多人都对这个问题很苦恼，最后在 stackoverflow 里找到了一个大牛给出了一个解码的实现 <a href="http://stackoverflow.com/questions/11783062/how-to-decrypt-an-encrypted-file-in-java-with-openssl-with-aes">stackoverflow </a>我根据这位大牛的代码简单的修改了一下，就做成了我需要的代码：</p>
<script src="https://gist.github.com/turbidsoul/5227012.js"></script>

<p>最后我想吐槽一下lua5.1居然不支持位运算，要5.2才支持，好吧，openresty集成的就是5.1所以我在实现lua的16位编码解码果然蛋疼了一下。</p>
                <a class="readmore" href="/posts/opensslhe-java-aessuan-fa-de-de-wen-ti.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/ftpde-portmo-shi-pasvmo-shi-fxpxie-yi-he-zai-javazhong-shi-yong-shi-de-xie-wen-ti.html" rel="bookmark"
                           title="Permalink to FTP的PORT模式，PASV模式， FXP协议和在java中使用时的一些问题">FTP的PORT模式，PASV模式， FXP协议和在java中使用时的一些问题</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-12-29T00:00:00">
                周六 29 十二月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/java.html">Java</a>. </p>
<p>tags: <a href="/tag/ftp.html">ftp</a><a href="/tag/port.html">port</a><a href="/tag/pasv.html">pasv</a><a href="/tag/fxp.html">fxp</a><a href="/tag/java.html">java</a></p>
</footer><!-- /.post-info -->                <p>这是最近一礼拜遇到的一个很头疼的问题，由于我们的系统需要需要用到ftp的fxp进行两个ftp服务器之间进行数据传输。 但是就是在这上出现了让我很郁闷的问题，连着几天，一个坑接一个坑，连续解决了5，6个问题，到今天下午才算是把所有问题解决。</p>
<p>在讲述我遇到的问题之前我们先了解下几个概念：</p>
<p>首先是PORT模式和PASV模式，也就是FTP的主动模式和被动模式：</p>
<ul>
<li>
<p>主动模式的FTP连接建立要遵循以下步骤：</p>
<ol>
<li>客户端打开一个随机的端口（端口号大于1024，在这里，我们称它为x），同时一个FTP进程连接至服务器的21号命令端口。此时，源端口为随机端口x，在客户端，远程端口为21，在服务器。</li>
<li>客户端开始监听端口（x+1），同时向服务器发送一个端口命令（通过服务器的21号命令端口），此命令告诉服务器客户端正在监听的端口号并且已准备好从此端口接收数据。这个端口就是我们所知的数据端口。</li>
<li>服务器打开20号源端口并且建立和客户端数据端口的连接。此时，源端口为20，远程数据端口为（x+1）。</li>
<li>客户端通过本地的数据端口建立一个和服务器20号端口的连接，然后向服务器发送一个应答，告诉服务器它已经建立好了一个连接。</li>
</ol>
</li>
<li>
<p>被动模式FTP: 为了解决服务器发起到客户的连接的问题，人们开发了一种不同的FTP连接方式。这就是所谓的被动方式，或者叫做PASV，当客户端通知服务器它处于被动模式时才启用。 在被动方式FTP中，命令连接和数据连接都由客户端发起，这样就可以解决从服务器到客户端的数据端口的入方向连接被防火墙过滤掉的问题。 当开启一个 FTP连接时，客户端打开两个任意的非特权本地端口 ...</p></li></ul>
                <a class="readmore" href="/posts/ftpde-portmo-shi-pasvmo-shi-fxpxie-yi-he-zai-javazhong-shi-yong-shi-de-xie-wen-ti.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/jrebelxiao-ji.html" rel="bookmark"
                           title="Permalink to JRebel小记">JRebel小记</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-12-15T00:00:00">
                周六 15 十二月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/java.html">Java</a>. </p>
<p>tags: <a href="/tag/java.html">java</a><a href="/tag/jrebel.html">jrebel</a></p>
</footer><!-- /.post-info -->                <blockquote>
<p>首先我先承认我标题党了，其实完全算不上简述，只是我这两天使用JRebel的一点心得吧。 当然我用的是盗版啦，谁让我有一个高富帅的心却是一个吊丝的命呢。 至于如何破解什么的请自己到网上搜索。</p>
</blockquote>
<p>进入正题，我使用的是 eclipse 4.2+RunJettyRun(jetty当然是8喽)+JRebel5.1 ，不过我用的破解的JRebel是5.0的， 直接覆盖，完全没问题。</p>
<p>首先说一下如何在通过RunJettyRun使用JRebel,其实很简单，只需要在启动的配置的 Arguments &gt; VM Arguments 中加入 “${jrebel_args}”就可以了， 这样在启动的时候就能看到JRebel启动：</p>
<div class="highlight"><pre><span class="k">[2012-12-15 22:32:17]</span>
<span class="err">[2012-12-15</span> <span class="err">22:32:17]</span> <span class="c1">#############################################################</span>
<span class="k">[2012-12-15 22:32:17]</span>
<span class="err">[2012-12-15</span> <span class="err">22:32:17]</span>  <span class="err">JRebel</span> <span class="err">5.0.0</span> <span class="err">(201206080930 ...</span></pre></div>
                <a class="readmore" href="/posts/jrebelxiao-ji.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/springpei-zhi-wen-jian-jia-zai-de-yi-wen-he-annotationjia-zai-de-wen-ti.html" rel="bookmark"
                           title="Permalink to Spring配置文件加载的疑问和annotation加载的问题">Spring配置文件加载的疑问和annotation加载的问题</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-02-24T00:00:00">
                周五 24 二月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/java.html">Java</a>. </p>
<p>tags: <a href="/tag/java.html">java</a><a href="/tag/sprint.html">sprint</a><a href="/tag/annotation.html">annotation</a></p>
</footer><!-- /.post-info -->                <p>前几天在做一个异步的模块，简单点说就是上传文件后，后台异步解析，前台定时请求解析的日志，并显示，算是一个实时的给用户看到解析的情况和日志，很简单的一个工作，但是我却遇到了一个让我郁闷了2天的问题。</p>
<p>问题的起因是在我做完所有工作后发现异步没有执行，也就是说文件的解析方法是同步运行的，也就是说先解析文件，解析完毕后在返回页面，页面才能请求到解析的日志，但是这会已经解析完了文件，没有达打到之前的需求。</p>
<p>这 里先简单的说下Spring异步的用法，Spring异步的用法很简单，在需要异步的方法加上annotation  <code>@Async</code> 声明自方法是异步调用的，同时还要在方法所在类上加上annotation <code>@Service</code>或<code>@Component</code> 在Spring在加载的时候可以扫描到这个类，然后需要在配置文件中加入<code>&lt;task:annotation-driven /&gt;</code>，这样就可以在Spring启动的时候，将异步处理器加入全局中，并在调用到有@Async的时候，异步调用。</p>
<p>上面简单说了下如何配置Spring异步，现在我说下我的问题，问题很简单就是配置类Spring 异步，并且确定配置正确，但是异步配置没有起效！问什么呢？我百思不得其解，没有办法，那就debug跟踪Spring的源代码。</p>
<p>在 debug的了几次之后，见到那的了解了Spring配置文件加载的方式，很简单，先加载<code>application-context ...</code></p>
                <a class="readmore" href="/posts/springpei-zhi-wen-jian-jia-zai-de-yi-wen-he-annotationjia-zai-de-wen-ti.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/java8de-bi-bao-lambdayu-ju-xiao-tan.html" rel="bookmark"
                           title="Permalink to java8的闭包Lambda语句小探">java8的闭包Lambda语句小探</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-02-14T00:00:00">
                周二 14 二月 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/turbidsoul.html">Turbidsoul</a>
        </address>
<p>In <a href="/category/java.html">Java</a>. </p>
<p>tags: <a href="/tag/java.html">java</a><a href="/tag/lambda.html">lambda</a><a href="/tag/closure.html">closure</a><a href="/tag/code.html">code</a></p>
</footer><!-- /.post-info -->                <p>这是我上个礼拜相对较闲的时候自己做的简单测试，应为那天正好在oschina上看到jdk1.8发布了开发者预览版，正好左右没事，就去下了一个，实验了一下java 的闭包。</p>
<p>java 闭包，也就是Lambda表达式，和python中的lambda是一样的，语法也挺相似：</p>
<div class="highlight"><pre><span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;!&quot;</span><span class="o">;</span>
</pre></div>


<p>下面我们来看个具体的例子：</p>
<p>首先定义一个接口:</p>
<div class="highlight"><pre><span class="kd">interface</span> <span class="nc">Lamb</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">str</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<p>之后我们就能在main方法中写下面的代码，编译并运行：</p>
<div class="highlight"><pre><span class="n">Lamb</span> <span class="n">str</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">;</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">str</span><span class="o">(</span><span class="s">&quot;aaa&quot;</span><span class="o">));</span>
</pre></div>


<p>运行结果：
<code>Hello, aaa</code>
上面是最简单的hello world！</p>
<p>在看一个多参数的例子:</p>
<div class="highlight"><pre><span class="kd">interface</span> <span class="nc">MathLamb</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="nf">add ...</span></pre></div>
                <a class="readmore" href="/posts/java8de-bi-bao-lambdayu-ju-xiao-tan.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 2
        <a href="/tag\java2.html">&raquo;</a>
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://blog.turbidsoul.me">Turbidsoul's 小黑屋</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>